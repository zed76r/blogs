---
title: 解决在Sandboxie中使用微信时无法备份聊天记录的问题
date: 2022-7-11 13:20
tags:
    - misc
categories:
    - 疑难杂症
---

因为出于对微信喜爱在文件系统里随地大小便和隐私保护的关系，我一直在通过sandboxie和后来的Sandboxie-plus中使用微信。
一方面限制了微信动手动脚的行为，另一方面也方便把微信写在系统各个角落的文件一波带走。
在Sandboxie-plus多次更新后，微信大部分功能（包括小程序）已经可用，但在标准和增强隔离的沙盒内，依旧无法使用备份和还原聊天记录的功能。

无意中测试Sandboxie-plus赞助版本的功能时发现，标准和增强隔离的沙盒默认不会触发防火墙规则修改的提示。当防火墙允许微信传入连接后功能恢复。

总结起来两种解决方案：

1. 手动添加防火墙规则：
    1. 通过sandboxie-plus的管理界面复制沙盒化的微信执行文件`wechat.exe`的位置
    1. 然后搜索`高级安全 Windows Defender防火墙`
    1. 点击入站规则
    1. 右侧点击新建规则
    1. 选择程序 -- 此程序路径 （粘贴步骤1复制的地址并去掉双引号） -- 允许连接 -- 勾选`专用`和`公用`  -- 名称（随便填） -- 保存
1. 通过试用赞助版本功能触发：
    1. 双击现有运行微信的沙盒
    1. 点击配置文本 -- 编辑配置
    1. 粘贴此配置 `NoSecurityIsolation=y`
    1. 终结沙盒内所有进程，重新运行微信，并使用一次备份触发防火墙设置，勾选`专用`和`公用`并确定。
    1. 回到沙盒配置文本移除之前添加的行

完成。问题解决。

另外对于想要使用sandboxie圈禁微信的朋友，分享使用的tips：
1. 如果使用增强隔离的模板沙盒，安装前请先双击打开沙盒设置 -- 管理员权限 -- 勾选`使应用程序认为...`
1. 在文件恢复选项卡里移除`%Personal%`文件夹规则，自行添加下载文件夹。避免微信写在文档的临时文件时也频繁的提示恢复。
1. 在常规选项 -- 文件选项 -- 勾选`保护此沙盒..` 避免误操作删除，毕竟微信聊天记录对于有的人还是很重要的。